name: Smoke Test - App Mento
on:
  deployment_status:

permissions:
  contents: read
  deployments: read
  pull-requests: write
  id-token: write

jobs:
  test:
    if: github.event_name == 'deployment_status' && github.event.deployment_status.state == 'success' && contains(github.event.deployment_status.target_url, 'appmento') && github.event.deployment.ref != 'main'
    uses: mento-protocol/mento-automation-tests/.github/workflows/app-mento-smoke-test.yml@main
    with:
      CUSTOM_URL: ${{ github.event.deployment_status.environment_url }}
      IS_MAINNET: "false"
    secrets: inherit

  summary:
    needs: test
    if: always() && github.event_name == 'deployment_status' && github.event.deployment_status.state == 'success' && contains(github.event.deployment_status.target_url, 'appmento') && github.event.deployment.ref != 'main'
    uses: ./.github/workflows/smoke-test-summary.yml
    with:
      test_result: ${{ needs.test.result }}
      app_name: App Mento
      deployment_url: ${{ github.event.deployment_status.environment_url }}
      deployment_sha: ${{ github.event.deployment.sha }}
