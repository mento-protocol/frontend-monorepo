name: Smoke Test - Governance
on:
  deployment_status:

permissions:
  contents: read
  deployments: read
  pull-requests: write
  id-token: write

jobs:
  test-eligibility:
    uses: ./.github/workflows/smoke-test-eligibility.yml
    with:
      target_url_pattern: governancemento

  test:
    needs: test-eligibility
    if: needs.test-eligibility.outputs.should_run == 'true'
    uses: mento-protocol/mento-automation-tests/.github/workflows/governance-smoke-test.yml@main
    with:
      CUSTOM_URL: ${{ github.event.deployment_status.environment_url }}
      IS_MAINNET: "false"
    secrets: inherit

  summary:
    needs: [test-eligibility, test]
    if: always() && needs.test-eligibility.outputs.should_run == 'true'
    uses: ./.github/workflows/smoke-test-summary.yml
    with:
      test_result: ${{ needs.test.result }}
      app_name: Governance
      deployment_url: ${{ github.event.deployment_status.environment_url }}
      deployment_sha: ${{ github.event.deployment.sha }}
